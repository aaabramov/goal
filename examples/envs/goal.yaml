current-context:
  desc: Current kubectl context
  cmd: kubectl
  args:
    - config
    - current-context

helm-dry-run:
  envs:
    dev:
      desc: Dry run upgrade on dev
      assert:
        desc: Check if on dev cluster
        ref: current-context
        expect: dev-cluster
      cmd: helm
      args:
        - upgrade
        - release-name
        - -f
        - values.yaml
        - -f
        - values/dev.yaml
        - .
        - --dry-run
    stage:
      desc: Dry run upgrade on stage
      assert:
        desc: Check if on stage cluster
        ref: current-context
        expect: stage-cluster
      cmd: helm
      args:
        - upgrade
        - release-name
        - -f
        - values.yaml
        - -f
        - values/stage.yaml
        - .
        - --dry-run

helm-upgrade:
  envs:
    dev:
      desc: Upgrade on dev
      assert:
        desc: Check if on dev cluster
        ref: current-context
        expect: dev-cluster
      cmd: helm
      args:
        - upgrade
        - release-name
        - -f
        - values.yaml
        - -f
        - values/dev.yaml
        - .
    stage:
      desc: Upgrade on stage
      assert:
        desc: Check if on stage cluster
        ref: current-context
        expect: stage-cluster
      cmd: helm
      args:
        - upgrade
        - release-name
        - -f
        - values.yaml
        - -f
        - values/stage.yaml
        - .
